<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <script src="https://cdnjs.cloudflare.com/ajax/libs/mithril/1.1.6/mithril.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/6a52086692.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <title>JCode AI</title>
    <style>
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script>
      const app = {
        state: {
          text: '',
          sentences: [],
          currentSentence: [],
          userSentence: [],
          score: 0,
          learning: false,
        },
        setText: function(text) {
          this.state.text = text;
          this.processText();
        },
        processText: function() {
          const sentences = this.state.text.match(/[^.!?]+[.!?]+/g) || [];
          this.state.sentences = sentences.map(sentence => {
            const words = sentence.trim().split(/\s+/);
            if (words.length < 5) {
              const nextSentence = sentences.shift();
              if (nextSentence) {
                return words.concat(nextSentence.trim().split(/\s+/)).join(' ');
              }
            }
            return words.join(' ');
          }).map(sentence => sentence.split(/\s+/));
          this.state.currentSentence = this.state.sentences.shift() || [];
          this.shuffleSentence();
        },
        shuffleSentence: function() {
          this.state.currentSentence = this.state.currentSentence
            .map(word => ({ word, sort: Math.random() }))
            .sort((a, b) => a.sort - b.sort)
            .map(({ word }) => word);
          this.state.userSentence = [];
        },
        addToUserSentence: function(word, index) {
          this.state.userSentence.push(word);
          this.state.currentSentence.splice(index, 1);
        },
        removeFromUserSentence: function(word, index) {
          this.state.currentSentence.push(word);
          this.state.userSentence.splice(index, 1);
        },
        checkOrder: function() {
          const correct = this.state.userSentence.join(' ') === this.state.currentSentence.join(' ');
          if (correct) {
            this.state.score += 1;
            this.state.currentSentence = this.state.sentences.shift() || [];
            if (this.state.currentSentence.length > 0) {
              this.shuffleSentence();
            }
          }
        },
        view: function() {
          return m('div', { class: 'p-4' }, [
            m('textarea', {
              class: `w-full h-32 p-2 mb-4 ${this.state.learning ? 'hidden' : ''}`,
              value: this.state.text,
              oninput: m.withAttr('value', this.setText.bind(this)),
              placeholder: 'Paste your text here...'
            }),
            m('div', { class: 'mb-4' }, [
              m('div', { class: 'flex flex-wrap gap-2 mb-2' }, this.state.userSentence.map((word, index) =>
                m('button', {
                  class: 'bg-blue-500 text-white p-2 rounded',
                  onclick: () => this.removeFromUserSentence(word, index)
                }, word)
              )),
              m('div', { class: 'flex flex-wrap gap-2' }, this.state.currentSentence.map((word, index) =>
                m('button', {
                  class: 'bg-gray-300 text-black p-2 rounded',
                  onclick: () => this.addToUserSentence(word, index)
                }, word)
              ))
            ]),
            m('button', {
              class: 'bg-green-500 text-white p-2 rounded mb-4',
              onclick: this.checkOrder.bind(this),
              disabled: this.state.currentSentence.length > 0
            }, 'Check Order'),
            m('p', `Score: ${this.state.score}`)
          ]);
        }
      };

      m.mount(document.getElementById('app'), app);
    </script>
  </body>
</html>
